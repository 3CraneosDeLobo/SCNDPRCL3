// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace Segundo_Parcial.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Segundo_Parcial;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\_Imports.razor"
using Segundo_Parcial.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\Pages\Index.razor"
using Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\Pages\Index.razor"
using System.IO;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 100 "D:\Tareas\5to Cuatrimestre\PROG 3\Xdxdxdxd\Segundo Parcial\Pages\Index.razor"
       
    ///////////////

public string cedula;
public string name;
public DateTime fecha = DateTime.Now;
public string que;
public double valor;
public string donde;

public double latitud;
public double longitud;

public int switch_on = 1;
public int idU {get; set;}
DBRobosContext context = new DBRobosContext();



List<Robo> GetRobos() => context.Robos.ToList();



    protected override async Task OnAfterRenderAsync(bool firstRender)
        {
            if(firstRender){
          await JS.InvokeVoidAsync("addMapa");
            }
        }

async ValueTask<float> Lat(){
    return await JS.InvokeAsync<float>("lat");
    }
    async ValueTask<float> Lng(){
    return await JS.InvokeAsync<float>("lng");
    }

   public async Task registrar(){
float lat = await Lat();
float lng = await Lng();

context.Add(new Robo {Cedula = cedula, Nombre = name, Fecha = fecha, Que = que, Valor = valor, Donde = donde, Lat = lat, Lgn = lng});

await context.SaveChangesAsync();
Limpiar();

    }


public void Editar(int id){
var data = context.Robos.First(x => x.Id == id);
cedula = data.Cedula;
name = data.Nombre;
fecha = Convert.ToDateTime(data.Fecha);
que = data.Que;
valor = Convert.ToDouble(data.Valor);
donde = data.Donde;
latitud = Convert.ToDouble(data.Lat);
longitud = Convert.ToDouble(data.Lgn); 
idU = data.Id;
switch_on = 2;




}

async Task Actualizar(){
    float lat = await Lat();
float lng = await Lng();
var data = context.Robos.First(x => x.Id == idU);

data.Cedula = cedula;
data.Nombre = name;
data.Fecha = fecha;
data.Que = que;
data.Valor = valor;
data.Donde = donde;
data.Lat = lat;
data.Lgn = lng;
context.Update(data);
await context.SaveChangesAsync();
Limpiar();
switch_on = 1;
}


public void Limpiar(){
    
   cedula = "";
name = "";
fecha = DateTime.Now;
que = "";
valor = 0;
donde = "";
latitud = 0;
longitud = 0; 
idU = 0;
}

///// Exportar a HTML

public void Exportar(int id){
var data = context.Robos.First(x => x.Id == id);

string ruta = Directory.GetCurrentDirectory();
string ruta2 = ruta+"\\Robos";

if(Directory.Exists(ruta2) == false){
    Directory.CreateDirectory(ruta2);
}

string content = "<html>" + 
"<body>"+
 "   <table border='2px' >" +
        "<thead>" +
            "<tr><th>Cedula</th><th>Nombre</th><th>Fecha</th><th>Que se Robaron</th><th>Valor</th><th>Donde Ocurrio</th><th>Latitud</th><th>Longitud</th></tr>" +
        "</thead>" +
       " <tbody>" + "<td>"+ data.Cedula+"</td>" +
         "<td>"+ data.Nombre+"</td>" + 
          "<td>"+ data.Fecha+"</td>" + 
          "<td>"+ data.Que+"</td>" + 
          "<td>"+ data.Valor+"</td>" + 
          "<td>"+ data.Donde+"</td>" + 
          "<td>"+ data.Lat+"</td>" + "<td>"+ data.Lgn+"</td>" + 
          "</tbody>"+
    "</table>"+


"</body>"+
"</html>";

string ruta3 = $"{ruta2}\\Robo{data.Id}.html";
File.WriteAllText(ruta3, content);
GoToSite(ruta3);






}

void GoToSite(string nav){
System.Diagnostics.Process myProcess = new System.Diagnostics.Process();
try{
myProcess.StartInfo.UseShellExecute = true;
myProcess.StartInfo.FileName = nav;
myProcess.Start();
}
catch (Exception e)
{
  Console.WriteLine(e.Message);
}



}


////////////////////

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JS { get; set; }
    }
}
#pragma warning restore 1591
